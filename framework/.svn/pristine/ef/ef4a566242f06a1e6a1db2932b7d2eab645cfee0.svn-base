<?php

/**
 * Created by PhpStorm.
 * User: tim
 * Date: 5/31/2015
 * Time: 1:15 AM
 */
class site_departModel extends tableModelBase
{
    public function  __construct()
    {
        parent::__construct('site_depart');
    }

    /**
     * 添加branch
     * @param $p
     * @return result
     */
    public function addDepart($p)
    {
        $depart_code = trim($p['depart_code']);
        $depart_name = trim($p['depart_name']);
        if (empty($depart_code) || empty($depart_name)) {
            return new result(false, 'Code and name cannot be empty!');
        }
        $row = $this->newRow();
        $row->depart_code = $depart_code;
        $row->depart_name = $depart_name;
        $rt = $row->insert();
        if ($rt->STS) {
            return new result(true, 'Add successful!');
        } else {
            return new result(false, 'Add failed--' . $rt->MSG);
        }
    }

    /**
     * 编辑部门
     * @param $p
     * @return result
     * @throws Exception
     */
    public function editDepart($p)
    {
        $uid = intval($p['uid']);
        $depart_code = trim($p['depart_code']);
        $depart_name = trim($p['depart_name']);
        if (empty($depart_code) || empty($depart_name)) {
            return new result(false, 'Code and name cannot be empty!');
        }
        $row = $this->getRow(array('uid' => $uid));
        if ($row->depart_code == $depart_code && $row->depart_name == $depart_name) {
            return new result(false, 'No change!');
        }
        $row->depart_code = $depart_code;
        $row->depart_name = $depart_name;
        $rt = $row->update();
        if ($rt->STS) {
            return new result(true, 'Edit successful!');
        } else {
            return new result(false, 'Edit failed--' . $rt->MSG);
        }
    }

    /**
     * 删除部门
     * @param $uid
     * @return result
     * todo::判断是否可删除
     */
    public function deleteDepart($uid)
    {
        $rt = $this->delete(array('uid' => $uid));
        if ($rt->STS) {
            return new result(true, 'Delete successful!');
        } else {
            return new result(false, 'Delete failed--' . $rt->MSG);
        }
    }

}
