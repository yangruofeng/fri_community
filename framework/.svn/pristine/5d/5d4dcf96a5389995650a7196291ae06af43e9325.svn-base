<?php

defined('InKHBuy') or exit('Access Invalid!');

class indexControl extends control {
    public function __construct()
    {
        parent::__construct();
        Tpl::setDir('home');
        Tpl::setLayout('null_layout');
    }

    public function indexOp() {
      Tpl::showpage('sub_sql');
    }

    public function submit_scriptOp(){
      $text = $_POST['text'];
      $execsql_model = new execute_sqlModel();
      $row = $execsql_model->newRow();
      $row->sql = $text;
      $row->add_time = time();
      $rt = $row->insert();
      if($rt->STS){
        $data['state'] = true;
        $data['sql'] = $rt->SOURCE_ROW['sql'];
        $data['add_time'] = date("Y-m-d H:i:s",$rt->SOURCE_ROW['add_time']);
        echo json_encode($data);
      }else{
        $data['state'] = false;
        echo json_encode($data);
      }
    }

    public function listOp(){
      $execsql_model = new execute_sqlModel();
      $sql = "select * from execute_sql";
      $ret = $execsql_model->reader->getRows($sql);
      Tpl::output('list', $ret);
      Tpl::showpage('list');
    }

}
