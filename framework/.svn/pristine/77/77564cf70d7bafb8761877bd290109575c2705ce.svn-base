<?php

class clientControl {
  public function __construct(){
    Language::read('act,label,tip');
    Tpl::setLayout('empty_layout');
    Tpl::setDir('client');
  }

  public function indexOp(){
    $user_info = array('state' => 10);
    $token = $_GET['token'];
    $officer_id = $_GET['id'];
    if($token && $officer_id){
      $data['officer_id'] = $officer_id;
      $data['token'] = $token;
      $url = ENTRY_API_SITE_URL . '/officer.base.info.php';
      $rts = curl_post($url, $data);
      $rts = json_decode($rts, true);
      if ($rts['STS']) {
        $user_info = $rts['DATA']['user_info'];
        $user_info['token'] = $token;
        setNcCookie('token', $token);
        setNcCookie('member_id', $user_info['uid']);
        setNcCookie('user_code', $user_info['user_code']);
        setNcCookie('user_name', $user_info['user_name']);
      }
    }

    $params = array();
    $params['officer_id'] = cookie('member_id');
    $params['token'] = cookie('token');
    $url = ENTRY_API_SITE_URL.'/officer.followed.member.php';
    $rt = curl_post($url, $params);
    $rt = json_decode($rt, true);
    Tpl::output('list', $rt['DATA']);
    Tpl::output('html_title', 'Operator');
    Tpl::output('header_title', 'Operator');
    Tpl::output('nav_footer', 'client');
    Tpl::output('user_info', json_encode($user_info)); 
    Tpl::output('user_code', $user_info['user_code'] ? : cookie('user_code')); 
    Tpl::output('user_name', $user_info['user_name'] ? : cookie('user_name')); 
    Tpl::showPage('index');
  }
}
