<?php

class baseControl extends control
{
    public $user_id;
    public $user_name;
    public $user_info;
    public $auth_list;

    function __construct()
    {
        parent::__construct();
        Language::read('auth');
        $user = userBase::Current();
        $user_info = $user->property->toArray();
        $this->user_info = $user_info;
        $this->user_id = $user_info['uid'];
        $this->user_name = $user_info['user_code'];

        $this->auth_list = $user->getAuthList();
    }

    /**
     * 根据权限获取menu
     * @return array
     */
    protected function getResetMenu()
    {
        $index_menu = $this->getIndexMenu();
        foreach ($index_menu as $key => $menu) {
            foreach ($menu['child'] as $k => $child) {
                $argc = explode(',', $child['args']);
                $auth = $argc[1] . '_' . $argc[2];
                if (!in_array($auth, $this->auth_list)) {
                    unset($index_menu[$key]['child'][$k]);
                }
            }
            if (empty($index_menu[$key]['child'])) {
                unset($index_menu[$key]);
            }
        }
        return $index_menu;
    }

    /**
     * 定义menu
     * @return array
     */
    private function getIndexMenu()
    {
        $indexMenu = array(
            'user' => array(
                "title" => 'User',
                "icon" => "user-circle-o",
                'child' => array(
                    array('args' => 'microbank/backoffice,user,role', 'title' => 'Role'),
                    array('args' => 'microbank/backoffice,user,user', 'title' => 'User'),
                    array('args' => 'microbank/backoffice,user,log', 'title' => 'Log'),
                )
            ),
            'loan' => array(
                "title" => 'Loan',
                "icon" => "dollar",
                'child' => array(
                    array('args' => 'microbank/backoffice,loan,client', 'title' => 'Client'),
                    array('args' => 'microbank/backoffice,loan,credit', 'title' => 'Credit'),
                    array('args' => 'microbank/backoffice,loan,request', 'title' => 'Request'),
                    array('args' => 'microbank/backoffice,loan,contract', 'title' => 'Contract'),
                )
            ),
            'setting' => array(
                "title" => 'Setting',
                "icon" => "cog",
                'child' => array(
                    array('args' => 'microbank/backoffice,setting,companyInfo', 'title' => 'Company Info'),
                    array('args' => 'microbank/backoffice,setting,branch', 'title' => 'Branch'),
                    array('args' => 'microbank/backoffice,setting,department', 'title' => 'Department'),
                    array('args' => 'microbank/backoffice,region,list', 'title' => 'Region'),
//                    array('args' => 'microbank/backoffice,setting,dictionary', 'title' => 'Dictionary'),
                    array('args' => 'microbank/backoffice,setting,shotCode', 'title' => 'Shot Code'),
                    array('args' => 'microbank/backoffice,setting,codingRule', 'title' => 'Coding Rule'),
                    array('args' => 'microbank/backoffice,setting,loanProduct', 'title' => 'Loan Product'),
                )
            ),
            'dev' => array(
                "title" => 'Dev',
                "icon" => "connectdevelop",
                'child' => array(
                    array('args' => 'microbank/backoffice,dev,appVersion', 'title' => 'App Version'),
                )
            ),
            'report' => array(
                "title" => 'Report',
                "icon" => "bar-chart",
                'child' => array(
                    array('args' => 'backoffice,report,reportOverview', 'title' => 'Overview'),
                    array('args' => 'backoffice,report,clientList', 'title' => 'Client List'),
                    array('args' => 'backoffice,report,contractList', 'title' => 'Contract List'),
                    array('args' => 'backoffice,report,creditList', 'title' => 'Credit List'),
                    array('args' => 'backoffice,report,todayReport', 'title' => 'Today\'s Report'),
                    array('args' => 'backoffice,report,loanList', 'title' => 'Loan List'),
                    array('args' => 'backoffice,report,repaymentList', 'title' => 'Repayment List'),
                    array('args' => 'backoffice,report,assetLiability', 'title' => 'Asset Liability'),
                    array('args' => 'backoffice,report,profit', 'title' => 'Profit'),
                )
            ),
        );
        return $indexMenu;
    }

}
