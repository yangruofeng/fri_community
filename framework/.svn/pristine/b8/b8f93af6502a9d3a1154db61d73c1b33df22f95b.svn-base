<?php

class counter_baseControl extends control
{
    public $user_id;
    public $user_name;
    public $user_info;
    public $auth_list;

    function __construct()
    {
        Language::read('auth');
        $this->checkLogin();
        $user = userBase::Current('counter_info');
        $user_info = $user->property->toArray();
        $this->user_info = $user_info;
        $this->user_id = $user_info['uid'];
        $this->user_name = $user_info['user_code'];

        $this->auth_list = $user->getAuthList();
    }

    private function checkLogin()
    {
        if (!getSessionVar("is_login") || !getSessionVar("counter_info")) {
            $ref_url = request_uri();
            $login_url = getUrl("login", "login", array("ref_url" => urlencode($ref_url)), false, ENTRY_COUNTER_SITE_URL);
            @header('Location:' . $login_url);
            die();
        } else {
            return operator::getUserInfo();
        }
    }

    /**
     * 根据权限获取menu
     * @return array
     */
    protected function getResetMenu()
    {
        $index_menu = $this->getIndexMenu();
//        foreach ($index_menu as $key => $menu) {
//            foreach ($menu['child'] as $k => $child) {
//                $argc = explode(',', $child['args']);
//                $auth = $argc[1] . '_' . $argc[2];
//                if (!in_array($auth, $this->auth_list)) {
//                    unset($index_menu[$key]['child'][$k]);
//                }
//            }
//            if (empty($index_menu[$key]['child'])) {
//                unset($index_menu[$key]);
//            }
//        }
        return $index_menu;
    }

    /**
     * 定义menu
     * @return array
     */
    private function getIndexMenu()
    {
        $indexMenu = array(
            'member' => array(
                "title" => "Member",
                'args' => 'microbank/counter,member,register'
            ),
            'company' => array(
                "title" => "Company",
                'args' => 'microbank/counter,company,index'
            ),
            'service' => array(
                "title" => "Service",
                'args' => 'microbank/counter,service,index'
            ),
            'mortgage' => array(
                "title" => "Mortgage",
                'args' => 'microbank/counter,mortgage,index'
            ),
            'cash_on_hand' => array(
                "title" => "Cash On Hand",
                'args' => 'microbank/counter,cash,cashOnHand'
            ),
            'cash_in_vault' => array(
                "title" => "Cash In Vault",
                'args' => 'microbank/counter,cash,cashInVault'
            ),
        );
        return $indexMenu;
    }

}